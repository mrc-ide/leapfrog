// Generated by leapfrog cpp_generation: do not edit by hand
// This file is automatically generated. Do not edit this file. If you want to make changes
// edit leapfrog json files in `cpp_generation/modelSchemas` and run `uv run ./src/main.py` inside
// the `cpp_generation` folder.

#pragma once

#include <Rcpp.h>

#include "../config_mixer.hpp"

namespace leapfrog {
namespace internal {

template <typename T>
T* r_data(SEXP x) {
  static_assert(sizeof(T) == 0, "Only specializations of r_data can be used");
}

template <>
double* r_data(SEXP x) {
  return REAL(x);
}

template <>
int* r_data(SEXP x) {
  return INTEGER(x);
}

template <typename T, size_t Rank>
nda::array_ref_of_rank<T, Rank> parse_data(const Rcpp::List& data, const std::string& key, nda::shape_of_rank<Rank> shape) {
  SEXP array_data = data[key];

  int actual_length = LENGTH(array_data);
  int expected_length = shape.flat_max() + 1;

  if (actual_length < expected_length) {
    Rcpp::stop(
      "Invalid size of data for '%s', expected %d got %d",
      key, expected_length, actual_length
    );
  }
  return { r_data<T>(array_data), shape };
}

template <typename T, typename Shape>
void fill_initial_state(const Rcpp::List& data, const std::string& key, nda::array<T, Shape>& array) {
  SEXP array_data = data[key];

  nda::array_ref<T, Shape> array_ref(r_data<T>(array_data));

  nda::for_each_index(Shape(), [&](auto i) {
    array[i] = array_ref[i];
  });
}

template<typename real_type, MV ModelVariant>
struct DpAdapter<Language::R, real_type, ModelVariant> {
  using SS = SSMixed<ModelVariant>;
  using Config = DpConfig<real_type, ModelVariant>;

  static Config::Pars get_pars(
    const Rcpp::List &data,
    const Options<real_type> &opts
  ) {
    return {
      .base_pop = parse_data<real_type, 2>(data, "basepop", { nda::dim<>(0, SS::pAG, 1), nda::dim<>(0, SS::NS, (SS::pAG)) }),
      .survival_probability = parse_data<real_type, 3>(data, "Sx", { nda::dim<>(0, SS::pAG + 1, 1), nda::dim<>(0, SS::NS, (SS::pAG + 1)), nda::dim<>(0, opts.proj_steps, (SS::pAG + 1) * (SS::NS)) }),
      .net_migration = parse_data<real_type, 3>(data, "netmigr_adj", { nda::dim<>(0, SS::pAG, 1), nda::dim<>(0, SS::NS, (SS::pAG)), nda::dim<>(0, opts.proj_steps, (SS::pAG) * (SS::NS)) }),
      .age_specific_fertility_rate = parse_data<real_type, 2>(data, "asfr", { nda::dim<>(0, SS::p_fertility_age_groups, 1), nda::dim<>(0, opts.proj_steps, (SS::p_fertility_age_groups)) }),
      .births_sex_prop = parse_data<real_type, 2>(data, "births_sex_prop", { nda::dim<>(0, SS::NS, 1), nda::dim<>(0, opts.proj_steps, (SS::NS)) })
    };
  };

  static Config::State get_initial_state(
    const Rcpp::List &data
  ) {
    typename Config::State state;
    fill_initial_state<real_type, typename Config::State::shape_p_totpop>(data, "p_totpop", state.p_totpop);
    fill_initial_state<real_type, typename Config::State::shape_p_deaths_background_totpop>(data, "p_deaths_background_totpop", state.p_deaths_background_totpop);
    state.births = Rcpp::as<real_type>(data["births"]);
    return state;
  };

  static constexpr int output_count = 3;

  static int build_output(
    int index,
    const Config::OutputState& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names,
    const size_t& output_years
  ) {
    Rcpp::NumericVector r_p_totpop(SS::pAG * SS::NS * output_years);
    r_p_totpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_totpop.data(), state.p_totpop.size(), REAL(r_p_totpop));
    names[index + 0] = "p_totpop";
    ret[index + 0] = r_p_totpop;
    Rcpp::NumericVector r_p_deaths_background_totpop(SS::pAG * SS::NS * output_years);
    r_p_deaths_background_totpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_deaths_background_totpop.data(), state.p_deaths_background_totpop.size(), REAL(r_p_deaths_background_totpop));
    names[index + 1] = "p_deaths_background_totpop";
    ret[index + 1] = r_p_deaths_background_totpop;
    Rcpp::NumericVector r_births(output_years);
    r_births.attr("dim") = Rcpp::IntegerVector::create(output_years);
    std::copy_n(state.births.data(), state.births.size(), REAL(r_births));
    names[index + 2] = "births";
    ret[index + 2] = r_births;
    return index + output_count;
  };

  static int build_output_single_year(
    int index,
    const Config::State& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names
  ) {
    Rcpp::NumericVector r_p_totpop(SS::pAG * SS::NS);
    r_p_totpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_totpop.data(), state.p_totpop.size(), REAL(r_p_totpop));
    names[index + 0] = "p_totpop";
    ret[index + 0] = r_p_totpop;
    Rcpp::NumericVector r_p_deaths_background_totpop(SS::pAG * SS::NS);
    r_p_deaths_background_totpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_deaths_background_totpop.data(), state.p_deaths_background_totpop.size(), REAL(r_p_deaths_background_totpop));
    names[index + 1] = "p_deaths_background_totpop";
    ret[index + 1] = r_p_deaths_background_totpop;
    names[index + 2] = "births";
    ret[index + 2] = state.births;
    return index + output_count;
  };
};

template<typename real_type, MV ModelVariant>
struct HaAdapter<Language::R, real_type, ModelVariant> {
  using SS = SSMixed<ModelVariant>;
  using Config = HaConfig<real_type, ModelVariant>;

  static Config::Pars get_pars(
    const Rcpp::List &data,
    const Options<real_type> &opts
  ) {
    return {
      .input_adult_incidence_rate = parse_data<real_type, 1>(data, "incidinput", { nda::dim<>(0, opts.proj_steps, 1) }),
      .incidence_rate_ratio_age = parse_data<real_type, 3>(data, "incrr_age", { nda::dim<>(0, SS::pAG - SS::p_idx_hiv_first_adult, 1), nda::dim<>(0, SS::NS, (SS::pAG - SS::p_idx_hiv_first_adult)), nda::dim<>(0, opts.proj_steps, (SS::pAG - SS::p_idx_hiv_first_adult) * (SS::NS)) }),
      .incidence_rate_ratio_sex = parse_data<real_type, 1>(data, "incrr_sex", { nda::dim<>(0, opts.proj_steps, 1) }),
      .cd4_mortality = parse_data<real_type, 3>(data, "cd4_mort", { nda::dim<>(0, SS::hDS, 1), nda::dim<>(0, SS::hAG, (SS::hDS)), nda::dim<>(0, SS::NS, (SS::hDS) * (SS::hAG)) }),
      .cd4_progression = parse_data<real_type, 3>(data, "cd4_prog", { nda::dim<>(0, SS::hDS - 1, 1), nda::dim<>(0, SS::hAG, (SS::hDS - 1)), nda::dim<>(0, SS::NS, (SS::hDS - 1) * (SS::hAG)) }),
      .cd4_initial_distribution = parse_data<real_type, 3>(data, "cd4_initdist", { nda::dim<>(0, SS::hDS, 1), nda::dim<>(0, SS::hAG, (SS::hDS)), nda::dim<>(0, SS::NS, (SS::hDS) * (SS::hAG)) }),
      .scale_cd4_mortality = Rcpp::as<int>(data["scale_cd4_mort"]),
      .idx_hm_elig = parse_data<int, 1>(data, "artcd4elig_idx", { nda::dim<>(0, opts.proj_steps, 1) }),
      .art_mortality = parse_data<real_type, 4>(data, "art_mort", { nda::dim<>(0, SS::hTS, 1), nda::dim<>(0, SS::hDS, (SS::hTS)), nda::dim<>(0, SS::hAG, (SS::hTS) * (SS::hDS)), nda::dim<>(0, SS::NS, (SS::hTS) * (SS::hDS) * (SS::hAG)) }),
      .art_mortality_time_rate_ratio = parse_data<real_type, 2>(data, "artmx_timerr", { nda::dim<>(0, SS::hTS, 1), nda::dim<>(0, opts.proj_steps, (SS::hTS)) }),
      .cd4_nonaids_excess_mort = parse_data<real_type, 3>(data, "cd4_nonaids_excess_mort", { nda::dim<>(0, SS::hDS, 1), nda::dim<>(0, SS::hAG, (SS::hDS)), nda::dim<>(0, SS::NS, (SS::hDS) * (SS::hAG)) }),
      .art_nonaids_excess_mort = parse_data<real_type, 4>(data, "art_nonaids_excess_mort", { nda::dim<>(0, SS::hTS, 1), nda::dim<>(0, SS::hDS, (SS::hTS)), nda::dim<>(0, SS::hAG, (SS::hTS) * (SS::hDS)), nda::dim<>(0, SS::NS, (SS::hTS) * (SS::hDS) * (SS::hAG)) }),
      .dropout_recover_cd4 = Rcpp::as<int>(data["art_dropout_recover_cd4"]),
      .dropout_rate = parse_data<real_type, 1>(data, "art_dropout_rate", { nda::dim<>(0, opts.proj_steps, 1) }),
      .adults_on_art = parse_data<real_type, 2>(data, "art15plus_num", { nda::dim<>(0, SS::NS, 1), nda::dim<>(0, opts.proj_steps, (SS::NS)) }),
      .adults_on_art_is_percent = parse_data<int, 2>(data, "art15plus_isperc", { nda::dim<>(0, SS::NS, 1), nda::dim<>(0, opts.proj_steps, (SS::NS)) }),
      .initiation_mortality_weight = Rcpp::as<real_type>(data["art_alloc_mxweight"]),
      .h_art_stage_dur = parse_data<real_type, 1>(data, "h_art_stage_dur", { nda::dim<>(0, SS::hTS - 1, 1) }),
      .pAG_INCIDPOP = Rcpp::as<int>(data["pAG_INCIDPOP"]),
      .pIDX_INCIDPOP = Rcpp::as<int>(data["pIDX_INCIDPOP"])
    };
  };

  static Config::State get_initial_state(
    const Rcpp::List &data
  ) {
    typename Config::State state;
    fill_initial_state<real_type, typename Config::State::shape_p_hivpop>(data, "p_hivpop", state.p_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_p_deaths_background_hivpop>(data, "p_deaths_background_hivpop", state.p_deaths_background_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_h_hivpop>(data, "h_hivpop", state.h_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_h_artpop>(data, "h_artpop", state.h_artpop);
    fill_initial_state<real_type, typename Config::State::shape_h_hiv_deaths_no_art>(data, "h_hiv_deaths_no_art", state.h_hiv_deaths_no_art);
    fill_initial_state<real_type, typename Config::State::shape_h_deaths_excess_nonaids_no_art>(data, "h_deaths_excess_nonaids_no_art", state.h_deaths_excess_nonaids_no_art);
    fill_initial_state<real_type, typename Config::State::shape_p_infections>(data, "p_infections", state.p_infections);
    fill_initial_state<real_type, typename Config::State::shape_h_hiv_deaths_art>(data, "h_hiv_deaths_art", state.h_hiv_deaths_art);
    fill_initial_state<real_type, typename Config::State::shape_h_deaths_excess_nonaids_on_art>(data, "h_deaths_excess_nonaids_on_art", state.h_deaths_excess_nonaids_on_art);
    fill_initial_state<real_type, typename Config::State::shape_h_art_initiation>(data, "h_art_initiation", state.h_art_initiation);
    fill_initial_state<real_type, typename Config::State::shape_p_hiv_deaths>(data, "p_hiv_deaths", state.p_hiv_deaths);
    fill_initial_state<real_type, typename Config::State::shape_p_deaths_excess_nonaids>(data, "p_deaths_excess_nonaids", state.p_deaths_excess_nonaids);
    fill_initial_state<real_type, typename Config::State::shape_p_net_migration_hivpop>(data, "p_net_migration_hivpop", state.p_net_migration_hivpop);
    return state;
  };

  static constexpr int output_count = 13;

  static int build_output(
    int index,
    const Config::OutputState& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names,
    const size_t& output_years
  ) {
    Rcpp::NumericVector r_p_hivpop(SS::pAG * SS::NS * output_years);
    r_p_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_hivpop.data(), state.p_hivpop.size(), REAL(r_p_hivpop));
    names[index + 0] = "p_hivpop";
    ret[index + 0] = r_p_hivpop;
    Rcpp::NumericVector r_p_deaths_background_hivpop(SS::pAG * SS::NS * output_years);
    r_p_deaths_background_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_deaths_background_hivpop.data(), state.p_deaths_background_hivpop.size(), REAL(r_p_deaths_background_hivpop));
    names[index + 1] = "p_deaths_background_hivpop";
    ret[index + 1] = r_p_deaths_background_hivpop;
    Rcpp::NumericVector r_h_hivpop(SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_hivpop.data(), state.h_hivpop.size(), REAL(r_h_hivpop));
    names[index + 2] = "h_hivpop";
    ret[index + 2] = r_h_hivpop;
    Rcpp::NumericVector r_h_artpop(SS::hTS * SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_artpop.data(), state.h_artpop.size(), REAL(r_h_artpop));
    names[index + 3] = "h_artpop";
    ret[index + 3] = r_h_artpop;
    Rcpp::NumericVector r_h_hiv_deaths_no_art(SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_hiv_deaths_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_hiv_deaths_no_art.data(), state.h_hiv_deaths_no_art.size(), REAL(r_h_hiv_deaths_no_art));
    names[index + 4] = "h_hiv_deaths_no_art";
    ret[index + 4] = r_h_hiv_deaths_no_art;
    Rcpp::NumericVector r_h_deaths_excess_nonaids_no_art(SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_deaths_excess_nonaids_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_deaths_excess_nonaids_no_art.data(), state.h_deaths_excess_nonaids_no_art.size(), REAL(r_h_deaths_excess_nonaids_no_art));
    names[index + 5] = "h_deaths_excess_nonaids_no_art";
    ret[index + 5] = r_h_deaths_excess_nonaids_no_art;
    Rcpp::NumericVector r_p_infections(SS::pAG * SS::NS * output_years);
    r_p_infections.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_infections.data(), state.p_infections.size(), REAL(r_p_infections));
    names[index + 6] = "p_infections";
    ret[index + 6] = r_p_infections;
    Rcpp::NumericVector r_h_hiv_deaths_art(SS::hTS * SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_hiv_deaths_art.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_hiv_deaths_art.data(), state.h_hiv_deaths_art.size(), REAL(r_h_hiv_deaths_art));
    names[index + 7] = "h_hiv_deaths_art";
    ret[index + 7] = r_h_hiv_deaths_art;
    Rcpp::NumericVector r_h_deaths_excess_nonaids_on_art(SS::hTS * SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_deaths_excess_nonaids_on_art.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_deaths_excess_nonaids_on_art.data(), state.h_deaths_excess_nonaids_on_art.size(), REAL(r_h_deaths_excess_nonaids_on_art));
    names[index + 8] = "h_deaths_excess_nonaids_on_art";
    ret[index + 8] = r_h_deaths_excess_nonaids_on_art;
    Rcpp::NumericVector r_h_art_initiation(SS::hDS * SS::hAG * SS::NS * output_years);
    r_h_art_initiation.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS, output_years);
    std::copy_n(state.h_art_initiation.data(), state.h_art_initiation.size(), REAL(r_h_art_initiation));
    names[index + 9] = "h_art_initiation";
    ret[index + 9] = r_h_art_initiation;
    Rcpp::NumericVector r_p_hiv_deaths(SS::pAG * SS::NS * output_years);
    r_p_hiv_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_hiv_deaths.data(), state.p_hiv_deaths.size(), REAL(r_p_hiv_deaths));
    names[index + 10] = "p_hiv_deaths";
    ret[index + 10] = r_p_hiv_deaths;
    Rcpp::NumericVector r_p_deaths_excess_nonaids(SS::pAG * SS::NS * output_years);
    r_p_deaths_excess_nonaids.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_deaths_excess_nonaids.data(), state.p_deaths_excess_nonaids.size(), REAL(r_p_deaths_excess_nonaids));
    names[index + 11] = "p_deaths_excess_nonaids";
    ret[index + 11] = r_p_deaths_excess_nonaids;
    Rcpp::NumericVector r_p_net_migration_hivpop(SS::pAG * SS::NS * output_years);
    r_p_net_migration_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_net_migration_hivpop.data(), state.p_net_migration_hivpop.size(), REAL(r_p_net_migration_hivpop));
    names[index + 12] = "p_net_migration_hivpop";
    ret[index + 12] = r_p_net_migration_hivpop;
    return index + output_count;
  };

  static int build_output_single_year(
    int index,
    const Config::State& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names
  ) {
    Rcpp::NumericVector r_p_hivpop(SS::pAG * SS::NS);
    r_p_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_hivpop.data(), state.p_hivpop.size(), REAL(r_p_hivpop));
    names[index + 0] = "p_hivpop";
    ret[index + 0] = r_p_hivpop;
    Rcpp::NumericVector r_p_deaths_background_hivpop(SS::pAG * SS::NS);
    r_p_deaths_background_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_deaths_background_hivpop.data(), state.p_deaths_background_hivpop.size(), REAL(r_p_deaths_background_hivpop));
    names[index + 1] = "p_deaths_background_hivpop";
    ret[index + 1] = r_p_deaths_background_hivpop;
    Rcpp::NumericVector r_h_hivpop(SS::hDS * SS::hAG * SS::NS);
    r_h_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_hivpop.data(), state.h_hivpop.size(), REAL(r_h_hivpop));
    names[index + 2] = "h_hivpop";
    ret[index + 2] = r_h_hivpop;
    Rcpp::NumericVector r_h_artpop(SS::hTS * SS::hDS * SS::hAG * SS::NS);
    r_h_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_artpop.data(), state.h_artpop.size(), REAL(r_h_artpop));
    names[index + 3] = "h_artpop";
    ret[index + 3] = r_h_artpop;
    Rcpp::NumericVector r_h_hiv_deaths_no_art(SS::hDS * SS::hAG * SS::NS);
    r_h_hiv_deaths_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_hiv_deaths_no_art.data(), state.h_hiv_deaths_no_art.size(), REAL(r_h_hiv_deaths_no_art));
    names[index + 4] = "h_hiv_deaths_no_art";
    ret[index + 4] = r_h_hiv_deaths_no_art;
    Rcpp::NumericVector r_h_deaths_excess_nonaids_no_art(SS::hDS * SS::hAG * SS::NS);
    r_h_deaths_excess_nonaids_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_deaths_excess_nonaids_no_art.data(), state.h_deaths_excess_nonaids_no_art.size(), REAL(r_h_deaths_excess_nonaids_no_art));
    names[index + 5] = "h_deaths_excess_nonaids_no_art";
    ret[index + 5] = r_h_deaths_excess_nonaids_no_art;
    Rcpp::NumericVector r_p_infections(SS::pAG * SS::NS);
    r_p_infections.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_infections.data(), state.p_infections.size(), REAL(r_p_infections));
    names[index + 6] = "p_infections";
    ret[index + 6] = r_p_infections;
    Rcpp::NumericVector r_h_hiv_deaths_art(SS::hTS * SS::hDS * SS::hAG * SS::NS);
    r_h_hiv_deaths_art.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_hiv_deaths_art.data(), state.h_hiv_deaths_art.size(), REAL(r_h_hiv_deaths_art));
    names[index + 7] = "h_hiv_deaths_art";
    ret[index + 7] = r_h_hiv_deaths_art;
    Rcpp::NumericVector r_h_deaths_excess_nonaids_on_art(SS::hTS * SS::hDS * SS::hAG * SS::NS);
    r_h_deaths_excess_nonaids_on_art.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_deaths_excess_nonaids_on_art.data(), state.h_deaths_excess_nonaids_on_art.size(), REAL(r_h_deaths_excess_nonaids_on_art));
    names[index + 8] = "h_deaths_excess_nonaids_on_art";
    ret[index + 8] = r_h_deaths_excess_nonaids_on_art;
    Rcpp::NumericVector r_h_art_initiation(SS::hDS * SS::hAG * SS::NS);
    r_h_art_initiation.attr("dim") = Rcpp::IntegerVector::create(SS::hDS, SS::hAG, SS::NS);
    std::copy_n(state.h_art_initiation.data(), state.h_art_initiation.size(), REAL(r_h_art_initiation));
    names[index + 9] = "h_art_initiation";
    ret[index + 9] = r_h_art_initiation;
    Rcpp::NumericVector r_p_hiv_deaths(SS::pAG * SS::NS);
    r_p_hiv_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_hiv_deaths.data(), state.p_hiv_deaths.size(), REAL(r_p_hiv_deaths));
    names[index + 10] = "p_hiv_deaths";
    ret[index + 10] = r_p_hiv_deaths;
    Rcpp::NumericVector r_p_deaths_excess_nonaids(SS::pAG * SS::NS);
    r_p_deaths_excess_nonaids.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_deaths_excess_nonaids.data(), state.p_deaths_excess_nonaids.size(), REAL(r_p_deaths_excess_nonaids));
    names[index + 11] = "p_deaths_excess_nonaids";
    ret[index + 11] = r_p_deaths_excess_nonaids;
    Rcpp::NumericVector r_p_net_migration_hivpop(SS::pAG * SS::NS);
    r_p_net_migration_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_net_migration_hivpop.data(), state.p_net_migration_hivpop.size(), REAL(r_p_net_migration_hivpop));
    names[index + 12] = "p_net_migration_hivpop";
    ret[index + 12] = r_p_net_migration_hivpop;
    return index + output_count;
  };
};

template<typename real_type, MV ModelVariant>
struct HcAdapter<Language::R, real_type, ModelVariant> {
  using SS = SSMixed<ModelVariant>;
  using Config = HcConfig<real_type, ModelVariant>;

  static Config::Pars get_pars(
    const Rcpp::List &data,
    const Options<real_type> &opts
  ) {
    return {
      .hc_nosocomial = parse_data<real_type, 1>(data, "hc_nosocomial", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc1_cd4_dist = parse_data<real_type, 1>(data, "hc1_cd4_dist", { nda::dim<>(0, SS::hc1DS, 1) }),
      .hc1_cd4_mort = parse_data<real_type, 3>(data, "hc1_cd4_mort", { nda::dim<>(0, SS::hc1DS, 1), nda::dim<>(0, SS::hcTT, (SS::hc1DS)), nda::dim<>(0, SS::hc1AG, (SS::hc1DS) * (SS::hcTT)) }),
      .hc2_cd4_mort = parse_data<real_type, 3>(data, "hc2_cd4_mort", { nda::dim<>(0, SS::hc2DS, 1), nda::dim<>(0, SS::hcTT, (SS::hc2DS)), nda::dim<>(0, SS::hc2AG, (SS::hc2DS) * (SS::hcTT)) }),
      .hc1_cd4_prog = parse_data<real_type, 3>(data, "hc1_cd4_prog", { nda::dim<>(0, SS::hc1DS, 1), nda::dim<>(0, SS::hc1AG_c, (SS::hc1DS)), nda::dim<>(0, SS::NS, (SS::hc1DS) * (SS::hc1AG_c)) }),
      .hc2_cd4_prog = parse_data<real_type, 3>(data, "hc2_cd4_prog", { nda::dim<>(0, SS::hc2DS, 1), nda::dim<>(0, SS::hc2AG_c, (SS::hc2DS)), nda::dim<>(0, SS::NS, (SS::hc2DS) * (SS::hc2AG_c)) }),
      .ctx_val = parse_data<real_type, 1>(data, "ctx_val", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc_art_elig_age = parse_data<int, 1>(data, "hc_art_elig_age", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc_art_elig_cd4 = parse_data<int, 2>(data, "hc_art_elig_cd4", { nda::dim<>(0, SS::p_idx_hiv_first_adult, 1), nda::dim<>(0, opts.proj_steps, (SS::p_idx_hiv_first_adult)) }),
      .hc_art_mort_rr = parse_data<real_type, 3>(data, "hc_art_mort_rr", { nda::dim<>(0, SS::hTS, 1), nda::dim<>(0, SS::p_idx_hiv_first_adult, (SS::hTS)), nda::dim<>(0, opts.proj_steps, (SS::hTS) * (SS::p_idx_hiv_first_adult)) }),
      .hc1_art_mort = parse_data<real_type, 3>(data, "hc1_art_mort", { nda::dim<>(0, SS::hc1DS, 1), nda::dim<>(0, SS::hTS, (SS::hc1DS)), nda::dim<>(0, SS::hc1AG, (SS::hc1DS) * (SS::hTS)) }),
      .hc2_art_mort = parse_data<real_type, 3>(data, "hc2_art_mort", { nda::dim<>(0, SS::hc2DS, 1), nda::dim<>(0, SS::hTS, (SS::hc2DS)), nda::dim<>(0, SS::hc2AG, (SS::hc2DS) * (SS::hTS)) }),
      .hc_art_isperc = parse_data<int, 1>(data, "hc_art_isperc", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc_art_val = parse_data<real_type, 2>(data, "hc_art_val", { nda::dim<>(0, SS::hcAG_coarse, 1), nda::dim<>(0, opts.proj_steps, (SS::hcAG_coarse)) }),
      .hc_art_init_dist = parse_data<real_type, 2>(data, "hc_art_init_dist", { nda::dim<>(0, SS::p_idx_hiv_first_adult, 1), nda::dim<>(0, opts.proj_steps, (SS::p_idx_hiv_first_adult)) }),
      .fert_mult_by_age = parse_data<real_type, 2>(data, "fert_mult_by_age", { nda::dim<>(0, SS::hc_p_fertility_age_groups, 1), nda::dim<>(0, opts.proj_steps, (SS::hc_p_fertility_age_groups)) }),
      .fert_mult_off_art = parse_data<real_type, 1>(data, "cd4fert_rat", { nda::dim<>(0, SS::hDS, 1) }),
      .fert_mult_on_art = parse_data<real_type, 1>(data, "fert_mult_on_art", { nda::dim<>(0, SS::hc_p_fertility_age_groups, 1) }),
      .total_fertility_rate = parse_data<real_type, 1>(data, "tfr", { nda::dim<>(0, opts.proj_steps, 1) }),
      .PMTCT = parse_data<real_type, 2>(data, "PMTCT", { nda::dim<>(0, SS::hPS, 1), nda::dim<>(0, opts.proj_steps, (SS::hPS)) }),
      .vertical_transmission_rate = parse_data<real_type, 2>(data, "vertical_transmission_rate", { nda::dim<>(0, SS::hDS + 1, 1), nda::dim<>(0, SS::hVT, (SS::hDS + 1)) }),
      .PMTCT_transmission_rate = parse_data<real_type, 3>(data, "PMTCT_transmission_rate", { nda::dim<>(0, SS::hDS, 1), nda::dim<>(0, SS::hPS, (SS::hDS)), nda::dim<>(0, SS::hVT, (SS::hDS) * (SS::hPS)) }),
      .PMTCT_dropout = parse_data<real_type, 3>(data, "PMTCT_dropout", { nda::dim<>(0, SS::hPS, 1), nda::dim<>(0, SS::hVT_dropout, (SS::hPS)), nda::dim<>(0, opts.proj_steps, (SS::hPS) * (SS::hVT_dropout)) }),
      .PMTCT_input_is_percent = parse_data<int, 1>(data, "PMTCT_input_is_percent", { nda::dim<>(0, opts.proj_steps, 1) }),
      .breastfeeding_duration_art = parse_data<real_type, 2>(data, "breastfeeding_duration_art", { nda::dim<>(0, SS::hBF, 1), nda::dim<>(0, opts.proj_steps, (SS::hBF)) }),
      .breastfeeding_duration_no_art = parse_data<real_type, 2>(data, "breastfeeding_duration_no_art", { nda::dim<>(0, SS::hBF, 1), nda::dim<>(0, opts.proj_steps, (SS::hBF)) }),
      .infant_pop = parse_data<real_type, 3>(data, "infant_pop", { nda::dim<>(0, SS::hc_infant, 1), nda::dim<>(0, SS::NS, (SS::hc_infant)), nda::dim<>(0, opts.proj_steps, (SS::hc_infant) * (SS::NS)) }),
      .mat_hiv_births = parse_data<real_type, 1>(data, "mat_hiv_births", { nda::dim<>(0, opts.proj_steps, 1) }),
      .mat_prev_input = parse_data<int, 1>(data, "mat_prev_input", { nda::dim<>(0, opts.proj_steps, 1) }),
      .prop_lt200 = parse_data<real_type, 1>(data, "prop_lt200", { nda::dim<>(0, opts.proj_steps, 1) }),
      .prop_gte350 = parse_data<real_type, 1>(data, "prop_gte350", { nda::dim<>(0, opts.proj_steps, 1) }),
      .ctx_val_is_percent = parse_data<int, 1>(data, "ctx_val_is_percent", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc_art_is_age_spec = parse_data<int, 1>(data, "hc_art_is_age_spec", { nda::dim<>(0, opts.proj_steps, 1) }),
      .abortion = parse_data<real_type, 2>(data, "abortion", { nda::dim<>(0, SS::hAB_ind, 1), nda::dim<>(0, opts.proj_steps, (SS::hAB_ind)) }),
      .patients_reallocated = parse_data<real_type, 1>(data, "patients_reallocated", { nda::dim<>(0, opts.proj_steps, 1) }),
      .hc_art_ltfu = parse_data<real_type, 1>(data, "hc_art_ltfu", { nda::dim<>(0, opts.proj_steps, 1) }),
      .adult_female_infections = parse_data<real_type, 2>(data, "adult_female_infections", { nda::dim<>(0, SS::hc_p_fertility_age_groups, 1), nda::dim<>(0, opts.proj_steps, (SS::hc_p_fertility_age_groups)) }),
      .adult_female_hivnpop = parse_data<real_type, 2>(data, "adult_female_hivnpop", { nda::dim<>(0, SS::hc_p_fertility_age_groups, 1), nda::dim<>(0, opts.proj_steps, (SS::hc_p_fertility_age_groups)) }),
      .total_births = parse_data<real_type, 1>(data, "total_births", { nda::dim<>(0, opts.proj_steps, 1) }),
      .ctx_effect = parse_data<real_type, 1>(data, "ctx_effect", { nda::dim<>(0, 3, 1) }),
      .hc_art_start = Rcpp::as<int>(data["hc_art_start"]),
      .local_adj_factor = Rcpp::as<real_type>(data["frr_scalar"]),
      .hc_age_specific_fertility_rate = parse_data<real_type, 2>(data, "hc_age_specific_fertility_rate", { nda::dim<>(0, SS::hc_p_fertility_age_groups, 1), nda::dim<>(0, opts.proj_steps, (SS::hc_p_fertility_age_groups)) })
    };
  };

  static Config::State get_initial_state(
    const Rcpp::List &data
  ) {
    typename Config::State state;
    fill_initial_state<real_type, typename Config::State::shape_hiv_births_by_mat_age>(data, "hiv_births_by_mat_age", state.hiv_births_by_mat_age);
    fill_initial_state<real_type, typename Config::State::shape_hc1_hivpop>(data, "hc1_hivpop", state.hc1_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_hc2_hivpop>(data, "hc2_hivpop", state.hc2_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_hc1_artpop>(data, "hc1_artpop", state.hc1_artpop);
    fill_initial_state<real_type, typename Config::State::shape_hc2_artpop>(data, "hc2_artpop", state.hc2_artpop);
    fill_initial_state<real_type, typename Config::State::shape_hc1_noart_aids_deaths>(data, "hc1_noart_aids_deaths", state.hc1_noart_aids_deaths);
    fill_initial_state<real_type, typename Config::State::shape_hc2_noart_aids_deaths>(data, "hc2_noart_aids_deaths", state.hc2_noart_aids_deaths);
    fill_initial_state<real_type, typename Config::State::shape_hc1_art_aids_deaths>(data, "hc1_art_aids_deaths", state.hc1_art_aids_deaths);
    fill_initial_state<real_type, typename Config::State::shape_hc2_art_aids_deaths>(data, "hc2_art_aids_deaths", state.hc2_art_aids_deaths);
    fill_initial_state<real_type, typename Config::State::shape_hc_art_init>(data, "hc_art_init", state.hc_art_init);
    fill_initial_state<real_type, typename Config::State::shape_hc_art_need_init>(data, "hc_art_need_init", state.hc_art_need_init);
    state.hiv_births = Rcpp::as<real_type>(data["hiv_births"]);
    state.ctx_need = Rcpp::as<real_type>(data["ctx_need"]);
    fill_initial_state<real_type, typename Config::State::shape_infection_by_type>(data, "infection_by_type", state.infection_by_type);
    fill_initial_state<real_type, typename Config::State::shape_mtct_by_source_tr>(data, "mtct_by_source_tr", state.mtct_by_source_tr);
    fill_initial_state<real_type, typename Config::State::shape_mtct_by_source_women>(data, "mtct_by_source_women", state.mtct_by_source_women);
    fill_initial_state<real_type, typename Config::State::shape_mtct_by_source_hc_infections>(data, "mtct_by_source_hc_infections", state.mtct_by_source_hc_infections);
    fill_initial_state<real_type, typename Config::State::shape_pmtct_coverage_at_delivery>(data, "pmtct_coverage_at_delivery", state.pmtct_coverage_at_delivery);
    return state;
  };

  static constexpr int output_count = 18;

  static int build_output(
    int index,
    const Config::OutputState& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names,
    const size_t& output_years
  ) {
    Rcpp::NumericVector r_hiv_births_by_mat_age(SS::hc_p_fertility_age_groups * output_years);
    r_hiv_births_by_mat_age.attr("dim") = Rcpp::IntegerVector::create(SS::hc_p_fertility_age_groups, output_years);
    std::copy_n(state.hiv_births_by_mat_age.data(), state.hiv_births_by_mat_age.size(), REAL(r_hiv_births_by_mat_age));
    names[index + 0] = "hiv_births_by_mat_age";
    ret[index + 0] = r_hiv_births_by_mat_age;
    Rcpp::NumericVector r_hc1_hivpop(SS::hc1DS * SS::hcTT * SS::hc1AG * SS::NS * output_years);
    r_hc1_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hc1AG, SS::NS, output_years);
    std::copy_n(state.hc1_hivpop.data(), state.hc1_hivpop.size(), REAL(r_hc1_hivpop));
    names[index + 1] = "hc1_hivpop";
    ret[index + 1] = r_hc1_hivpop;
    Rcpp::NumericVector r_hc2_hivpop(SS::hc2DS * SS::hcTT * SS::hc2AG * SS::NS * output_years);
    r_hc2_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hc2DS, SS::hcTT, SS::hc2AG, SS::NS, output_years);
    std::copy_n(state.hc2_hivpop.data(), state.hc2_hivpop.size(), REAL(r_hc2_hivpop));
    names[index + 2] = "hc2_hivpop";
    ret[index + 2] = r_hc2_hivpop;
    Rcpp::NumericVector r_hc1_artpop(SS::hTS * SS::hc1DS * SS::hc1AG * SS::NS * output_years);
    r_hc1_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc1DS, SS::hc1AG, SS::NS, output_years);
    std::copy_n(state.hc1_artpop.data(), state.hc1_artpop.size(), REAL(r_hc1_artpop));
    names[index + 3] = "hc1_artpop";
    ret[index + 3] = r_hc1_artpop;
    Rcpp::NumericVector r_hc2_artpop(SS::hTS * SS::hc2DS * SS::hc2AG * SS::NS * output_years);
    r_hc2_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc2DS, SS::hc2AG, SS::NS, output_years);
    std::copy_n(state.hc2_artpop.data(), state.hc2_artpop.size(), REAL(r_hc2_artpop));
    names[index + 4] = "hc2_artpop";
    ret[index + 4] = r_hc2_artpop;
    Rcpp::NumericVector r_hc1_noart_aids_deaths(SS::hc1DS * SS::hcTT * SS::hc1AG * SS::NS * output_years);
    r_hc1_noart_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hc1AG, SS::NS, output_years);
    std::copy_n(state.hc1_noart_aids_deaths.data(), state.hc1_noart_aids_deaths.size(), REAL(r_hc1_noart_aids_deaths));
    names[index + 5] = "hc1_noart_aids_deaths";
    ret[index + 5] = r_hc1_noart_aids_deaths;
    Rcpp::NumericVector r_hc2_noart_aids_deaths(SS::hc2DS * SS::hcTT * SS::hc2AG * SS::NS * output_years);
    r_hc2_noart_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hc2DS, SS::hcTT, SS::hc2AG, SS::NS, output_years);
    std::copy_n(state.hc2_noart_aids_deaths.data(), state.hc2_noart_aids_deaths.size(), REAL(r_hc2_noart_aids_deaths));
    names[index + 6] = "hc2_noart_aids_deaths";
    ret[index + 6] = r_hc2_noart_aids_deaths;
    Rcpp::NumericVector r_hc1_art_aids_deaths(SS::hTS * SS::hc1DS * SS::hc1AG * SS::NS * output_years);
    r_hc1_art_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc1DS, SS::hc1AG, SS::NS, output_years);
    std::copy_n(state.hc1_art_aids_deaths.data(), state.hc1_art_aids_deaths.size(), REAL(r_hc1_art_aids_deaths));
    names[index + 7] = "hc1_art_aids_deaths";
    ret[index + 7] = r_hc1_art_aids_deaths;
    Rcpp::NumericVector r_hc2_art_aids_deaths(SS::hTS * SS::hc2DS * SS::hc2AG * SS::NS * output_years);
    r_hc2_art_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc2DS, SS::hc2AG, SS::NS, output_years);
    std::copy_n(state.hc2_art_aids_deaths.data(), state.hc2_art_aids_deaths.size(), REAL(r_hc2_art_aids_deaths));
    names[index + 8] = "hc2_art_aids_deaths";
    ret[index + 8] = r_hc2_art_aids_deaths;
    Rcpp::NumericVector r_hc_art_init(SS::hcAG_coarse * output_years);
    r_hc_art_init.attr("dim") = Rcpp::IntegerVector::create(SS::hcAG_coarse, output_years);
    std::copy_n(state.hc_art_init.data(), state.hc_art_init.size(), REAL(r_hc_art_init));
    names[index + 9] = "hc_art_init";
    ret[index + 9] = r_hc_art_init;
    Rcpp::NumericVector r_hc_art_need_init(SS::hc1DS * SS::hcTT * SS::hcAG_end * SS::NS * output_years);
    r_hc_art_need_init.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hcAG_end, SS::NS, output_years);
    std::copy_n(state.hc_art_need_init.data(), state.hc_art_need_init.size(), REAL(r_hc_art_need_init));
    names[index + 10] = "hc_art_need_init";
    ret[index + 10] = r_hc_art_need_init;
    Rcpp::NumericVector r_hiv_births(output_years);
    r_hiv_births.attr("dim") = Rcpp::IntegerVector::create(output_years);
    std::copy_n(state.hiv_births.data(), state.hiv_births.size(), REAL(r_hiv_births));
    names[index + 11] = "hiv_births";
    ret[index + 11] = r_hiv_births;
    Rcpp::NumericVector r_ctx_need(output_years);
    r_ctx_need.attr("dim") = Rcpp::IntegerVector::create(output_years);
    std::copy_n(state.ctx_need.data(), state.ctx_need.size(), REAL(r_ctx_need));
    names[index + 12] = "ctx_need";
    ret[index + 12] = r_ctx_need;
    Rcpp::NumericVector r_infection_by_type(SS::hcTT * SS::hc1AG * SS::NS * output_years);
    r_infection_by_type.attr("dim") = Rcpp::IntegerVector::create(SS::hcTT, SS::hc1AG, SS::NS, output_years);
    std::copy_n(state.infection_by_type.data(), state.infection_by_type.size(), REAL(r_infection_by_type));
    names[index + 13] = "infection_by_type";
    ret[index + 13] = r_infection_by_type;
    Rcpp::NumericVector r_mtct_by_source_tr(SS::mtct_source * SS::hcTT_expanded * output_years);
    r_mtct_by_source_tr.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source, SS::hcTT_expanded, output_years);
    std::copy_n(state.mtct_by_source_tr.data(), state.mtct_by_source_tr.size(), REAL(r_mtct_by_source_tr));
    names[index + 14] = "mtct_by_source_tr";
    ret[index + 14] = r_mtct_by_source_tr;
    Rcpp::NumericVector r_mtct_by_source_women(SS::mtct_source * output_years);
    r_mtct_by_source_women.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source, output_years);
    std::copy_n(state.mtct_by_source_women.data(), state.mtct_by_source_women.size(), REAL(r_mtct_by_source_women));
    names[index + 15] = "mtct_by_source_women";
    ret[index + 15] = r_mtct_by_source_women;
    Rcpp::NumericVector r_mtct_by_source_hc_infections(SS::mtct_source * SS::hcTT_expanded * output_years);
    r_mtct_by_source_hc_infections.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source, SS::hcTT_expanded, output_years);
    std::copy_n(state.mtct_by_source_hc_infections.data(), state.mtct_by_source_hc_infections.size(), REAL(r_mtct_by_source_hc_infections));
    names[index + 16] = "mtct_by_source_hc_infections";
    ret[index + 16] = r_mtct_by_source_hc_infections;
    Rcpp::NumericVector r_pmtct_coverage_at_delivery(SS::hPS * output_years);
    r_pmtct_coverage_at_delivery.attr("dim") = Rcpp::IntegerVector::create(SS::hPS, output_years);
    std::copy_n(state.pmtct_coverage_at_delivery.data(), state.pmtct_coverage_at_delivery.size(), REAL(r_pmtct_coverage_at_delivery));
    names[index + 17] = "pmtct_coverage_at_delivery";
    ret[index + 17] = r_pmtct_coverage_at_delivery;
    return index + output_count;
  };

  static int build_output_single_year(
    int index,
    const Config::State& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names
  ) {
    Rcpp::NumericVector r_hiv_births_by_mat_age(SS::hc_p_fertility_age_groups);
    r_hiv_births_by_mat_age.attr("dim") = Rcpp::IntegerVector::create(SS::hc_p_fertility_age_groups);
    std::copy_n(state.hiv_births_by_mat_age.data(), state.hiv_births_by_mat_age.size(), REAL(r_hiv_births_by_mat_age));
    names[index + 0] = "hiv_births_by_mat_age";
    ret[index + 0] = r_hiv_births_by_mat_age;
    Rcpp::NumericVector r_hc1_hivpop(SS::hc1DS * SS::hcTT * SS::hc1AG * SS::NS);
    r_hc1_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hc1AG, SS::NS);
    std::copy_n(state.hc1_hivpop.data(), state.hc1_hivpop.size(), REAL(r_hc1_hivpop));
    names[index + 1] = "hc1_hivpop";
    ret[index + 1] = r_hc1_hivpop;
    Rcpp::NumericVector r_hc2_hivpop(SS::hc2DS * SS::hcTT * SS::hc2AG * SS::NS);
    r_hc2_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::hc2DS, SS::hcTT, SS::hc2AG, SS::NS);
    std::copy_n(state.hc2_hivpop.data(), state.hc2_hivpop.size(), REAL(r_hc2_hivpop));
    names[index + 2] = "hc2_hivpop";
    ret[index + 2] = r_hc2_hivpop;
    Rcpp::NumericVector r_hc1_artpop(SS::hTS * SS::hc1DS * SS::hc1AG * SS::NS);
    r_hc1_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc1DS, SS::hc1AG, SS::NS);
    std::copy_n(state.hc1_artpop.data(), state.hc1_artpop.size(), REAL(r_hc1_artpop));
    names[index + 3] = "hc1_artpop";
    ret[index + 3] = r_hc1_artpop;
    Rcpp::NumericVector r_hc2_artpop(SS::hTS * SS::hc2DS * SS::hc2AG * SS::NS);
    r_hc2_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc2DS, SS::hc2AG, SS::NS);
    std::copy_n(state.hc2_artpop.data(), state.hc2_artpop.size(), REAL(r_hc2_artpop));
    names[index + 4] = "hc2_artpop";
    ret[index + 4] = r_hc2_artpop;
    Rcpp::NumericVector r_hc1_noart_aids_deaths(SS::hc1DS * SS::hcTT * SS::hc1AG * SS::NS);
    r_hc1_noart_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hc1AG, SS::NS);
    std::copy_n(state.hc1_noart_aids_deaths.data(), state.hc1_noart_aids_deaths.size(), REAL(r_hc1_noart_aids_deaths));
    names[index + 5] = "hc1_noart_aids_deaths";
    ret[index + 5] = r_hc1_noart_aids_deaths;
    Rcpp::NumericVector r_hc2_noart_aids_deaths(SS::hc2DS * SS::hcTT * SS::hc2AG * SS::NS);
    r_hc2_noart_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hc2DS, SS::hcTT, SS::hc2AG, SS::NS);
    std::copy_n(state.hc2_noart_aids_deaths.data(), state.hc2_noart_aids_deaths.size(), REAL(r_hc2_noart_aids_deaths));
    names[index + 6] = "hc2_noart_aids_deaths";
    ret[index + 6] = r_hc2_noart_aids_deaths;
    Rcpp::NumericVector r_hc1_art_aids_deaths(SS::hTS * SS::hc1DS * SS::hc1AG * SS::NS);
    r_hc1_art_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc1DS, SS::hc1AG, SS::NS);
    std::copy_n(state.hc1_art_aids_deaths.data(), state.hc1_art_aids_deaths.size(), REAL(r_hc1_art_aids_deaths));
    names[index + 7] = "hc1_art_aids_deaths";
    ret[index + 7] = r_hc1_art_aids_deaths;
    Rcpp::NumericVector r_hc2_art_aids_deaths(SS::hTS * SS::hc2DS * SS::hc2AG * SS::NS);
    r_hc2_art_aids_deaths.attr("dim") = Rcpp::IntegerVector::create(SS::hTS, SS::hc2DS, SS::hc2AG, SS::NS);
    std::copy_n(state.hc2_art_aids_deaths.data(), state.hc2_art_aids_deaths.size(), REAL(r_hc2_art_aids_deaths));
    names[index + 8] = "hc2_art_aids_deaths";
    ret[index + 8] = r_hc2_art_aids_deaths;
    Rcpp::NumericVector r_hc_art_init(SS::hcAG_coarse);
    r_hc_art_init.attr("dim") = Rcpp::IntegerVector::create(SS::hcAG_coarse);
    std::copy_n(state.hc_art_init.data(), state.hc_art_init.size(), REAL(r_hc_art_init));
    names[index + 9] = "hc_art_init";
    ret[index + 9] = r_hc_art_init;
    Rcpp::NumericVector r_hc_art_need_init(SS::hc1DS * SS::hcTT * SS::hcAG_end * SS::NS);
    r_hc_art_need_init.attr("dim") = Rcpp::IntegerVector::create(SS::hc1DS, SS::hcTT, SS::hcAG_end, SS::NS);
    std::copy_n(state.hc_art_need_init.data(), state.hc_art_need_init.size(), REAL(r_hc_art_need_init));
    names[index + 10] = "hc_art_need_init";
    ret[index + 10] = r_hc_art_need_init;
    names[index + 11] = "hiv_births";
    ret[index + 11] = state.hiv_births;
    names[index + 12] = "ctx_need";
    ret[index + 12] = state.ctx_need;
    Rcpp::NumericVector r_infection_by_type(SS::hcTT * SS::hc1AG * SS::NS);
    r_infection_by_type.attr("dim") = Rcpp::IntegerVector::create(SS::hcTT, SS::hc1AG, SS::NS);
    std::copy_n(state.infection_by_type.data(), state.infection_by_type.size(), REAL(r_infection_by_type));
    names[index + 13] = "infection_by_type";
    ret[index + 13] = r_infection_by_type;
    Rcpp::NumericVector r_mtct_by_source_tr(SS::mtct_source * SS::hcTT_expanded);
    r_mtct_by_source_tr.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source, SS::hcTT_expanded);
    std::copy_n(state.mtct_by_source_tr.data(), state.mtct_by_source_tr.size(), REAL(r_mtct_by_source_tr));
    names[index + 14] = "mtct_by_source_tr";
    ret[index + 14] = r_mtct_by_source_tr;
    Rcpp::NumericVector r_mtct_by_source_women(SS::mtct_source);
    r_mtct_by_source_women.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source);
    std::copy_n(state.mtct_by_source_women.data(), state.mtct_by_source_women.size(), REAL(r_mtct_by_source_women));
    names[index + 15] = "mtct_by_source_women";
    ret[index + 15] = r_mtct_by_source_women;
    Rcpp::NumericVector r_mtct_by_source_hc_infections(SS::mtct_source * SS::hcTT_expanded);
    r_mtct_by_source_hc_infections.attr("dim") = Rcpp::IntegerVector::create(SS::mtct_source, SS::hcTT_expanded);
    std::copy_n(state.mtct_by_source_hc_infections.data(), state.mtct_by_source_hc_infections.size(), REAL(r_mtct_by_source_hc_infections));
    names[index + 16] = "mtct_by_source_hc_infections";
    ret[index + 16] = r_mtct_by_source_hc_infections;
    Rcpp::NumericVector r_pmtct_coverage_at_delivery(SS::hPS);
    r_pmtct_coverage_at_delivery.attr("dim") = Rcpp::IntegerVector::create(SS::hPS);
    std::copy_n(state.pmtct_coverage_at_delivery.data(), state.pmtct_coverage_at_delivery.size(), REAL(r_pmtct_coverage_at_delivery));
    names[index + 17] = "pmtct_coverage_at_delivery";
    ret[index + 17] = r_pmtct_coverage_at_delivery;
    return index + output_count;
  };
};

template<typename real_type, MV ModelVariant>
struct SpAdapter<Language::R, real_type, ModelVariant> {
  using SS = SSMixed<ModelVariant>;
  using Config = SpConfig<real_type, ModelVariant>;

  static Config::Pars get_pars(
    const Rcpp::List &data,
    const Options<real_type> &opts
  ) {
    return {
    };
  };

  static Config::State get_initial_state(
    const Rcpp::List &data
  ) {
    typename Config::State state;
    fill_initial_state<real_type, typename Config::State::shape_p_deaths_nonaids_artpop>(data, "p_deaths_nonaids_artpop", state.p_deaths_nonaids_artpop);
    fill_initial_state<real_type, typename Config::State::shape_p_deaths_nonaids_hivpop>(data, "p_deaths_nonaids_hivpop", state.p_deaths_nonaids_hivpop);
    fill_initial_state<real_type, typename Config::State::shape_p_excess_deaths_nonaids_on_art>(data, "p_excess_deaths_nonaids_on_art", state.p_excess_deaths_nonaids_on_art);
    fill_initial_state<real_type, typename Config::State::shape_p_excess_deaths_nonaids_no_art>(data, "p_excess_deaths_nonaids_no_art", state.p_excess_deaths_nonaids_no_art);
    return state;
  };

  static constexpr int output_count = 4;

  static int build_output(
    int index,
    const Config::OutputState& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names,
    const size_t& output_years
  ) {
    Rcpp::NumericVector r_p_deaths_nonaids_artpop(SS::pAG * SS::NS * output_years);
    r_p_deaths_nonaids_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_deaths_nonaids_artpop.data(), state.p_deaths_nonaids_artpop.size(), REAL(r_p_deaths_nonaids_artpop));
    names[index + 0] = "p_deaths_nonaids_artpop";
    ret[index + 0] = r_p_deaths_nonaids_artpop;
    Rcpp::NumericVector r_p_deaths_nonaids_hivpop(SS::pAG * SS::NS * output_years);
    r_p_deaths_nonaids_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_deaths_nonaids_hivpop.data(), state.p_deaths_nonaids_hivpop.size(), REAL(r_p_deaths_nonaids_hivpop));
    names[index + 1] = "p_deaths_nonaids_hivpop";
    ret[index + 1] = r_p_deaths_nonaids_hivpop;
    Rcpp::NumericVector r_p_excess_deaths_nonaids_on_art(SS::pAG * SS::NS * output_years);
    r_p_excess_deaths_nonaids_on_art.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_excess_deaths_nonaids_on_art.data(), state.p_excess_deaths_nonaids_on_art.size(), REAL(r_p_excess_deaths_nonaids_on_art));
    names[index + 2] = "p_excess_deaths_nonaids_on_art";
    ret[index + 2] = r_p_excess_deaths_nonaids_on_art;
    Rcpp::NumericVector r_p_excess_deaths_nonaids_no_art(SS::pAG * SS::NS * output_years);
    r_p_excess_deaths_nonaids_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS, output_years);
    std::copy_n(state.p_excess_deaths_nonaids_no_art.data(), state.p_excess_deaths_nonaids_no_art.size(), REAL(r_p_excess_deaths_nonaids_no_art));
    names[index + 3] = "p_excess_deaths_nonaids_no_art";
    ret[index + 3] = r_p_excess_deaths_nonaids_no_art;
    return index + output_count;
  };

  static int build_output_single_year(
    int index,
    const Config::State& state,
    Rcpp::List& ret,
    Rcpp::CharacterVector& names
  ) {
    Rcpp::NumericVector r_p_deaths_nonaids_artpop(SS::pAG * SS::NS);
    r_p_deaths_nonaids_artpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_deaths_nonaids_artpop.data(), state.p_deaths_nonaids_artpop.size(), REAL(r_p_deaths_nonaids_artpop));
    names[index + 0] = "p_deaths_nonaids_artpop";
    ret[index + 0] = r_p_deaths_nonaids_artpop;
    Rcpp::NumericVector r_p_deaths_nonaids_hivpop(SS::pAG * SS::NS);
    r_p_deaths_nonaids_hivpop.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_deaths_nonaids_hivpop.data(), state.p_deaths_nonaids_hivpop.size(), REAL(r_p_deaths_nonaids_hivpop));
    names[index + 1] = "p_deaths_nonaids_hivpop";
    ret[index + 1] = r_p_deaths_nonaids_hivpop;
    Rcpp::NumericVector r_p_excess_deaths_nonaids_on_art(SS::pAG * SS::NS);
    r_p_excess_deaths_nonaids_on_art.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_excess_deaths_nonaids_on_art.data(), state.p_excess_deaths_nonaids_on_art.size(), REAL(r_p_excess_deaths_nonaids_on_art));
    names[index + 2] = "p_excess_deaths_nonaids_on_art";
    ret[index + 2] = r_p_excess_deaths_nonaids_on_art;
    Rcpp::NumericVector r_p_excess_deaths_nonaids_no_art(SS::pAG * SS::NS);
    r_p_excess_deaths_nonaids_no_art.attr("dim") = Rcpp::IntegerVector::create(SS::pAG, SS::NS);
    std::copy_n(state.p_excess_deaths_nonaids_no_art.data(), state.p_excess_deaths_nonaids_no_art.size(), REAL(r_p_excess_deaths_nonaids_no_art));
    names[index + 3] = "p_excess_deaths_nonaids_no_art";
    ret[index + 3] = r_p_excess_deaths_nonaids_no_art;
    return index + output_count;
  };
};

} // namespace internal
} // namespace leapfrog
