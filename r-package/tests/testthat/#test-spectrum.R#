
setwd("~/Downloads/frogger/r-package/")

parameters <- read_parameters(test_path("testdata/spectrum_params.h5"))
  out <- run_model(parameters, "Spectrum")

  expected_output <- c(
    "p_deaths_nonaids_artpop", "p_deaths_nonaids_hivpop",
    "p_excess_deaths_nonaids_no_art", "p_excess_deaths_nonaids_on_art"
  )
  expect_true(all(expected_output %in% names(out)))
  # Always 0 for children
  expect_true(all(out$p_deaths_nonaids_artpop[1:15, , ] == 0))
  expect_true(all(out$p_deaths_nonaids_hivpop[1:15, , ] == 0))
  expect_true(any(out$p_deaths_nonaids_artpop > 0))
  expect_true(any(out$p_deaths_nonaids_hivpop > 0))

  expect_true(all(out$p_excess_deaths_nonaids_no_art[1:15, , ] == 0))
  expect_true(all(out$p_excess_deaths_nonaids_on_art[1:15, , ] == 0))
  expect_true(any(out$p_excess_deaths_nonaids_no_art > 0))
  expect_true(any(out$p_excess_deaths_nonaids_on_art > 0))


idx <- 40; round(new2$p_hiv_pop[16:81,,idx] - (colSums(new2$h_hiv_adult[,,,idx],,1) + colSums(new2$h_art_adult[,,,,idx],,2)),3)

mailto:KHNSIH001@myuct.ac.za
khnsih001@myuct.ac.za